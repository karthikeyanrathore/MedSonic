# https://github.com/peter-evans/docker-compose-actions-workflow
# https://github.com/peter-evans/smoke-testing

name: docker-compose-actions-workflow
on:   
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Scheduler: set to run every month on Monday at 17:00.
    - cron: '0 17 1 * 0'

jobs:
  docker-healthcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the stack
        run: docker-compose up -d
      - name: server-healthcheck
        run: docker run --network container:medsonic-api jwilder/dockerize -wait http://localhost:8080/v1/diabetes -timeout 10s -wait-retry-interval 5s
  docker-compose-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: build medsonic-api service
        run: docker-compose build medsonic-api
      - name: server-test
        run: docker-compose run medsonic-api sh  -c "python -m pytest -v"



